<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날씨</title>
    <link rel="stylesheet" href="css/weather-icons-wind.css">
    <link rel="stylesheet" href="css/weather-icons-wind.min.css">
    <link rel="stylesheet" href="css/weather-icons.css">

</head>

<body>
    <table width=800>
        <tr>
            <td>지금 날씨 어때?<br>

    <input id="addressName" value="" type="text">
    <button id="search">검색</button>
    <br>

    <p style="font-size:10px;"></p>
    <!-- <span id="city-aqi-container-display"></span> -->
    <br>
    <div id="map" style="width:80%;height:200px;"></div>
    </td>
        </tr>
    </table>
    

    <script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=4f87397342a5a6257622aad28f62bca9"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>



    <script>

        $(document).ready(function () {
            $("#search").click(function () {
                $("p").empty(); // 검색 버튼을 눌렀을 때 p 태그의 내용을 비운다.



                $.ajax({
                    method: "GET",
                    url: "https://dapi.kakao.com/v2/local/search/address.json",
                    data: { query: $("#addressName").val() },
                    headers: { Authorization: "KakaoAK eaba352137de06ddce13c272d9ce9756" }
                })
                    .done(function (msg) {
                        console.log(msg);

                        $("p").append("지번주소 : " + msg.documents[0].address.address_name + "<br>");
                        $("p").append("도로명주소 : " + msg.documents[0].road_address.address_name + "<br>");
                        $("p").append("위도,경도: " + msg.documents[0].road_address.y + ", " + msg.documents[0].road_address.x +
                            "<br>");
                        $("p").append("우편번호 : " + msg.documents[0].road_address.zone_no + "<br><br>");


                        var y = msg.documents[0].road_address.y;
                        var x = msg.documents[0].road_address.x;

                        //(function (w, d, t, f) {
                        //    w[f] = w[f] || function (c, k, n) {
                        //        s = w[f], k = s['k'] = (s['k'] || (k ? ('&k=' + k) : '')); s['c'] =
                        //            c = (c instanceof Array) ? c : [c]; s['n'] = n = n || 0; L = d.createElement(t), e = d.getElementsByTagName(t)[0];
                        //        L.async = 1; L.src = 'http://feed.aqicn.org/feed/' + (c[n].city) + '/' + (c[n].lang || '') + '/feed.v1.js?n=' + n + k;
                        //        e.parentNode.insertBefore(L, e);
                        //    };
                        //})(window, document, 'script', '_aqiFeed');



                        var container = document.getElementById('map');
                        var options = {
                            center: new kakao.maps.LatLng(y, x),
                            level: 3
                        };


                        $.ajax({
                            method: "GET",
                            url: "https://api.openweathermap.org/data/2.5/weather?lat=" + y + "&lon=" + x + "&appid=49c020e9c5d0d8084687f4fbcc283554&units=metric"

                        })
                            .done(function (m) {
                                console.log(m);
                                //var temp = (m.main.temp - 273).toFixed(2);

                                $("p").append("온도 : " + m.main.temp + "℃, 습도 : " + m.main.humidity + "%,&nbsp;");
                                //$("p").append( "<img src='http://openweathermap.org/img/w/" + m.weather[0].icon + ".png'>");
                                $("p").append("&nbsp;<i class='wi wi-owm-" + m.weather[0].id + "'></i>");
                                $("p").append("&nbsp;" + m.weather[0].description + ",&nbsp;");
                                $("p").append("&nbsp;" + m.name + "<br><br>");

                               // _aqiFeed({ container: "city-aqi-container", city: "" + m.name + "" });
                               // _aqiFeed({
                               //     display: "<strong> %cityname 미세먼지 : %aqi &nbsp;on  %date</strong>",
                               //     container: "city-aqi-container-display",
                               //     city: "" + m.name + "" 
                                //});
                            });

                            $.ajax({
                            method: "GET",
                            url: "https://api.waqi.info/feed/geo:"+y+";"+x+"/?token=a3217fdd5b58dd94f22869ee9d3c13c59c4c6ac2" 

                        })
                            .done(function (pm) {
                                console.log(pm);
                                //var temp = (m.main.temp - 273).toFixed(2);
                                if(pm.data.iaqi.pm25.v <=15) {
                                    var level = "좋음";
                                    var color = "#0080FF";
                                } else if(pm.data.iaqi.pm25.v <=35) {
                                    var level = "보통";
                                    var color = "#3ADF00";
                                } else if(pm.data.iaqi.pm25.v <=75) {
                                    var level = "나쁨";
                                    var color = "#FF8000";
                                } else if(pm.data.iaqi.pm25.v <=150) {
                                    var level = "매우나쁨";
                                    var color = "#FE2E2E";
                                };

                                if(pm.data.iaqi.pm10.v <=30) {
                                    var pm10_level = "좋음";
                                    var pm10_color = "#0080FF";
                                } else if(pm.data.iaqi.pm10.v <=80) {
                                    var pm10_level = "보통";
                                    var pm10_color = "#3ADF00";
                                } else if(pm.data.iaqi.pm10.v <=150) {
                                    var pm10_level = "나쁨";
                                    var pm10_color = "#FF8000";
                                } else if(pm.data.iaqi.pm10.v <=1000) {
                                    var pm10_level = "매우나쁨";
                                    var pm10_color = "#FE2E2E";
                                };
                               
                                $("p").append("초미세먼지(PM2.5) : <SPAN STYLE='background-color:"+color+";'><i><font color='white'>&nbsp;" + pm.data.iaqi.pm25.v +"("+ level +  ")&nbsp;&nbsp;</i></font></span>, 미세먼지(PM10) : <SPAN STYLE='background-color:"+pm10_color+";'><i><font color='white'>&nbsp;"+pm.data.iaqi.pm10.v+"("+ pm10_level +  ")&nbsp;&nbsp;</i></font></span>,&nbsp; " +pm.data.time.s+"<br>");
                                

                               // _aqiFeed({ container: "city-aqi-container", city: "" + m.name + "" });
                               // _aqiFeed({
                               //     display: "<strong> %cityname 미세먼지 : %aqi &nbsp;on  %date</strong>",
                               //     container: "city-aqi-container-display",
                               //     city: "" + m.name + "" 
                                //});
                            });

                            



                        var map = new kakao.maps.Map(container, options);
                        // 지도에 교통mm정보를 표시하도록 지도타입을 추가합니다
                        map.addOverlayMapTypeId(kakao.maps.MapTypeId.TRAFFIC);

                        // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
                        var mapTypeControl = new kakao.maps.MapTypeControl();

                        // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
                        // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
                        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

                        // 지도 확대 축소를 제어할 수 있는 줌 컨트롤을 생성합니다
                        var zoomControl = new kakao.maps.ZoomControl();
                        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                        // 마커가 표시될 위치입니다
                        var markerPosition = new kakao.maps.LatLng(y, x);
                        //35.23072905809429, 128.86373038245176
                        //35.23029526879373, 128.8638001214764 0.0004

                        // 마커를 생성합니다
                        var marker = new kakao.maps.Marker({
                            position: markerPosition

                        });

                        // 마커가 지도 위에 표시되도록 설정합니다
                        marker.setMap(map);
                    });
            });
            $('#addressName').keypress(function (event) {
                if (event.which == 13) {
                    $('#search').click();
                    return false; // 검색창에서 엔터 쳤을 때
                }
            });
        });
    </script>







</body>

</html>
